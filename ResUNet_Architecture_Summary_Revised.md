# ResUNet 网络结构总结

## 概述

ResUNet 是论文《Deep Learning-Driven One-Shot Dual-View 3-D Reconstruction for Dual-Projector System》中提出的深度学习网络，用于双投影仪单相机结构光3D测量系统（DL-DPSL）。它结合了 UNet 的编码-解码结构、残差连接（ResNet）和 Inception 模块（GoogleNet），以高效解码叠加相位移光栅图像，实现快速、精准的3D重建。ResUNet 通过单次拍摄完成双视角相位恢复，解决了传统条纹投影轮廓术（FPP）在速度、精度和遮挡处理上的局限。

## 网络结构详解

ResUNet 采用 U 形架构，包含编码器（下采样）、解码器（上采样）和跳跃连接，结合残差模块和 Inception 思想。以下是其详细结构：

### 1. 编码器（下采样路径）

- **功能**：从输入图像中提取多尺度特征，从低级纹理到高级语义信息。
- **结构**：
  - 包含 5 个残差模块（Residual Blocks）。
  - 每个残差模块后接一个 2x2 最大池化层（步幅 2），将空间尺寸减半。
  - 通道数逐层增加（例如 64 → 128 → 256 → 512 → 1024），增强特征表达能力。
- **实现细节**：
  - 每个残差模块通过多尺度卷积提取特征，结合残差连接避免信息丢失。
  - 最大池化减少计算量，同时保留关键特征。

### 2. 解码器（上采样路径）

- **功能**：从压缩特征图中恢复空间分辨率，生成输出相位图。
- **结构**：
  - 包含 5 个残差模块。
  - 每个残差模块前接一个 2x2 转置卷积层（步幅 2），将空间尺寸翻倍。
  - 通过跳跃连接（Skip Connections）将编码器对应层的特征图与解码器特征图拼接，保留低级空间细节。
- **实现细节**：
  - 通道数逐层减少（例如 1024 → 512 → 256 → 128 → 64），逐步恢复到接近输入尺寸。
  - 跳跃连接通过特征拼接（Concatenation）融合多尺度信息。

### 3. 残差模块（图2）

- **功能**：结合 Inception 模块的多尺度特征提取和残差连接，增强网络对复杂光栅的解码能力。
- **结构**：
  - 包含 5 个分支：
    - **Branch0**：1x1 卷积，用于降维和非线性特征提取，输出通道数为 `out_channels`。
    - **Branch1**：单个 3x3 卷积，输出通道数为 `out_channels//4`。
    - **Branch2**：两个 3x3 卷积，输出通道数为 `out_channels//4`。
    - **Branch3**：三个 3x3 卷积，输出通道数为 `out_channels//4`。
    - **Branch4**：四个 3x3 卷积，输出通道数为 `out_channels//4`。
  - 分支1-4的输出拼接后通过 1x1 卷积调整通道数，与 Branch0 输出相加（残差连接），最后应用 ReLU 激活。
- **实现细节**：
  - 每个分支后接批量归一化（BatchNorm）和 ReLU 激活。
  - 残差连接确保信息流动顺畅，缓解深层网络的梯度消失问题。

### 4. 整体网络结构（图3(b)）

- **描述**：
  - U 形架构，左侧为编码器（5 次下采样），右侧为解码器（5 次上采样）。
  - 编码器和解码器通过跳跃连接（图中灰色箭头）连接，对应层的特征图拼接以保留细节。
  - 通道数变化示例：输入 1 通道，编码器依次为 64、128、256、512、1024，解码器反向为 512、256、128、64，最终输出 2 通道。
- **输出层**：
  - 最后通过 1x1 卷积将特征图降为 2 个通道，生成两个绝对相位图。

### 5. 关键特性

- **UNet 基础**：提供强大的编码-解码框架，适合回归任务。
- **残差连接**：增强信息流动，缓解深层网络退化问题。
- **Inception 模块**：通过多尺度卷积提取丰富特征，提升对复杂光栅的处理能力。

## 输入

- **类型**：单通道高频叠加相位移光栅图像。
- **描述**：
  - 由双投影仪单相机系统（DL-DPSL）捕获，两个投影仪同时投射相位移光栅，分别表示为：
    $$ L_1(x, y) = \cos(2\pi f x) $$
    $$ L_2(x, y) = \cos(2\pi f y) $$
  - 相机捕获叠加光栅图案，尺寸通常为 640x512（真实数据）或 256x256（模拟数据）。
- **格式**：2D 单通道图像，包含两个投影仪的相位信息。

## 输出

- **类型**：两个绝对相位图。
- **描述**：
  - 表示两个投影视角（左、右）的绝对相位（\(\Phi_1\) 和 \(\Phi_2\)）。
  - 通过相位解缠公式计算：
    $$ \Phi_k(x, y) = \phi_k(x, y) + 2\pi k_h(x, y) $$
    其中，\(\phi_k(x, y)\) 是包裹相位，\(k_h(x, y)\) 是整数周期数。
- **格式**：两个 2D 单通道图像，与输入尺寸相同。

## 实现效果

ResUNet 在 DL-DPSL 系统中表现出色，解决了传统 FPP 在速度、精度和遮挡处理上的局限。以下是具体效果：

### 1. 速度

- **成果**：整个3D重建过程（投影+相位恢复）约需 0.018 秒。
- **细节**：
  - 得益于单次拍摄和 ResUNet 的高效解码，适合实时工业应用。
  - 使用 NVIDIA GeForce RTX 3090 GPU 实现快速推理。

### 2. 精度

- **成果**：模拟数据上平均绝对误差（MAE）降低高达 20%，真实数据在连续区域表现更优。
- **细节**：
  - ResUNet 能从复杂叠加光栅中精确提取相位信息。
  - 实验表明，系统在复杂表面处理上优于传统方法。

### 3. 稳定性

- **成果**：相比现有最快深度学习系统（DL_SPSL），ResUNet 在稳定性上更优。
- **细节**：
  - 残差连接和 Inception 模块增强了模型对遮挡和复杂几何的鲁棒性。
  - 在真实和模拟数据上均表现出一致的性能。

### 4. 工业适用性

- **细节**：
  - 系统解决了测量范围、速度和精度的矛盾。
  - 适用于制造业、设计等领域的大范围物体快速扫描。

## 附加信息

- **训练**：
  - 使用 PyTorch（版本 2.0.1 +cu117 + Python 3.9.13）在 NVIDIA GeForce RTX 3090 GPU 上训练。
  - 优化器采用 Adam，损失函数为 L1 损失（预测输出与真实相位图的绝对平均误差）。
- **数据集**：
  - 真实数据集：约 1000 组（640x512 分辨率）。
  - 模拟数据集：约 3000 组（256x256 分辨率）。
- **评估指标**：
  - 使用平均绝对误差（MAE）和均方根误差（RMSE），与论文 Table II 一致。

## 网络结构表

以下表格总结了 ResUNet 的编码器和解码器结构：

| 层级 | 类型       | 输入通道 | 输出通道 | 操作                     | 输出尺寸（示例，输入 640x512） |
|------|------------|----------|----------|--------------------------|-------------------------------|
| 输入 | 输入层     | 1        | -        | -                        | 640x512                       |
| 编码器1 | 残差模块   | 1        | 64       | 残差模块 + 最大池化      | 320x256                       |
| 编码器2 | 残差模块   | 64       | 128      | 残差模块 + 最大池化      | 160x128                       |
| 编码器3 | 残差模块   | 128      | 256      | 残差模块 + 最大池化      | 80x64                         |
| 编码器4 | 残差模块   | 256      | 512      | 残差模块 + 最大池化      | 40x32                         |
| 编码器5 | 残差模块   | 512      | 1024     | 残差模块                 | 20x16                         |
| 解码器4 | 残差模块   | 1024+512 | 512      | 转置卷积 + 拼接 + 残差模块 | 40x32                       |
| 解码器3 | 残差模块   | 512+256  | 256      | 转置卷积 + 拼接 + 残差模块 | 80x64                       |
| 解码器2 | 残差模块   | 256+128  | 128      | 转置卷积 + 拼接 + 残差模块 | 160x128                     |
| 解码器1 | 残差模块   | 128+64   | 64       | 转置卷积 + 拼接 + 残差模块 | 320x256                     |
| 输出 | 输出层     | 64       | 2        | 1x1 卷积                 | 640x512                       |

## 结论

ResUNet 是一个高效的深度学习网络，通过 U 形架构、残差连接和 Inception 模块，实现了从单张叠加光栅图像到双视角绝对相位图的快速解码。其在速度（0.018秒）、精度（MAE降低20%）和稳定性上的优异表现，使其成为工业3D重建的理想选择。网络结构灵活，支持不同分辨率输入，适用于多种应用场景。
